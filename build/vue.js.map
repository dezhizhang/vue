{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["\nlet oldArrayProto = Array.prototype;\n\nexport let newArrayProto = Object.create(oldArrayProto);\n\nlet methods = [\n    'push',\n    'pop',\n    'shift',\n    'unshift',\n    'resolve',\n    'sort',\n    'splice'\n];\n\n\nmethods.forEach(method => {\n    newArrayProto[method] = function (...args) {\n        const result = oldArrayProto[method].call(this, ...args);\n\n        // 新增数据进行却持\n        let inserted;\n        let ob = this.__ob__;\n\n        switch (method) {\n            case 'push':\n            case 'unshift':\n                inserted = args;\n                break;\n            case 'splice':\n                inserted = args.slice(2);\n                break;\n            default:\n                break;\n        }\n\n        if(inserted) {\n            ob.observeArray(inserted);\n        }\n    }\n})","\nimport { newArrayProto } from './array';\nclass Observer {\n    constructor(data) {\n        Object.defineProperty(data, '__ob__', {\n            value: this,\n            enumerable: false,\n        });\n        if (Array.isArray(data)) {\n            data.__proto__ = newArrayProto;\n            this.observeArray(data);\n        } else {\n            this.walk(data);\n        }\n\n    }\n\n    walk(target) {\n        Object.keys(target).forEach(key => {\n            defineReactive(target, key, target[key]);\n        })\n    }\n    observeArray(data) {\n        data.forEach(item => observe(item))\n    }\n}\n\nfunction defineReactive(target, key, value) {\n    observe(value);\n    Object.defineProperty(target, key, {\n        get() {\n            return value;\n        },\n        set(newValue) {\n            if (newValue === value) return;\n            observe(newValue);\n            value = newValue;\n        }\n    })\n}\n\nexport function observe(data) {\n    if (typeof data !== 'object' || data == null) {\n        return; // 不是对像不能观测\n    }\n    if (data._ob_ instanceof Observer) {\n        return data._ob_;\n    }\n    return new Observer(data);\n}","\nimport { observe } from './observer/index';\n\nexport function initState(vm) {\n    // 获取所有的选项\n    const opt = vm.$options;\n    if(opt.data) {\n        initData(vm)\n    }\n}\n\nexport function initData(vm) {\n    let data = vm.$options.data;\n    data = vm._data = typeof data === 'function' ? data.call(vm):data;\n    observe(data);\n    console.log('data',data)\n}","\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\nconst startTagOpen = new RegExp(`^<${qnameCapture}`);\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\nconst startTagClose = /^\\s*(\\/?)>/;\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\n\nfunction parseHTML(html) {\n    function advance(n) {\n        html = html.substring(n);\n    }\n    function parseStartTag() {\n        const start = html.match(startTagOpen);\n        if (start) {\n            const match = {\n                tagName: start[1],\n                attrs: [],\n            }\n            advance(start[1].length);\n\n            let attr, end;\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\n                advance(attr[0].length);\n                match.attrs.push({ name: attr[1], value: attr[3] || attr[4] || attr[5] })\n            }\n\n            if (end) {\n                advance(end[0].length);\n            }\n            return match;\n\n        }\n        return false;\n    }\n    while (html) {\n        let textEnd = html.indexOf('<');\n        if (textEnd === 0) {\n            const startTagMatch = parseStartTag();\n            if (startTagMatch) {\n                continue;\n            }\n            let endTagMatch = html.match(endTag);\n            if (endTag) {\n                advance(endTagMatch[0].length);\n                continue\n            }\n            break;\n        }\n        if (textEnd > 0) {\n            let text = html.substring(0, textEnd);\n            if (text) {\n                advance(text.length);\n            }\n        }\n    }\n    console.log(html);\n}\n\n\nexport function compileToFunction(template) {\n    parseHTML(template);\n}","import { initState } from './state';\nimport { compileToFunction } from './compiler/index';\n\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n\n        const vm = this;\n        vm.$options = options;\n\n        // 初始化状态\n        initState(vm);\n\n        // 初始化模板\n        if(options.el) {\n            vm.$mount(options.el);\n        }\n    }\n\n    Vue.prototype.$mount = function(el) {\n        const vm = this;\n        const opt = vm.$options;\n        el = document.querySelector(el);\n        if(!opt.render) {\n            let template;\n            if(!opt.template && el) {\n                template = el.outerHTML;\n            }else if(el){\n                template = opt.template;\n            }\n            if(template) {\n                compileToFunction(template);\n            }\n        }\n    }\n}\n\n","\nimport { initMixin } from './init';\n\nfunction Vue(options) {\n   this._init(options);\n}\n\ninitMixin(Vue)\n\nexport default Vue;\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","call","inserted","ob","__ob__","slice","observeArray","Observer","data","defineProperty","value","enumerable","isArray","__proto__","walk","target","keys","key","defineReactive","item","observe","get","set","newValue","_ob_","initState","vm","opt","$options","initData","_data","console","log","ncname","qnameCapture","startTagOpen","RegExp","endTag","startTagClose","attribute","parseHTML","html","advance","n","substring","parseStartTag","start","match","tagName","attrs","length","attr","end","push","name","textEnd","indexOf","startTagMatch","endTagMatch","text","compileToFunction","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}